# Sub-agent Review

Claude Code のサブエージェント実装をベストプラクティスに照らしてレビューし、具体的な改善提案を提供するスキルです。

## 概要

このスキルは、Claude Code のサブエージェント設定ファイルを 5 つの観点から評価し、フォーカス、セキュリティ、効果性を確保するための具体的な改善提案を提供します。システムプロンプト、ツールアクセス権限、バージョン管理統合などのベストプラクティスに準拠しているかをチェックします。

## インストール

### 前提条件

Claude Code CLI がインストールされている必要があります。

### マーケットプレースの追加

```bash
/plugin marketplace add interactive-inc/claude-plugins
```

### プラグインのインストール

```bash
/plugin install claude@interactive-claude-plugins
```

## 主な機能

- **5つの評価観点**: 単一責任原則、システムプロンプト品質、ツールアクセス制限、バージョン管理統合、適切な基盤
- **3段階評価**: ✅ 優秀 / ⚠️ 要改善 / ❌ 致命的な問題
- **優先度付き推奨事項**: セキュリティ > フォーカス > 最適化
- **具体的な改善例**: Before/After 形式で推奨される変更を提示
- **2つの出力形式**: 詳細レビュー形式と簡易評価形式

## 使用タイミング

このスキルは以下のような場合に使用します：

- サブエージェント設定を新規作成した後の品質チェック
- 既存サブエージェントの改善点を特定したい
- サブエージェントの設定監査やベストプラクティス準拠確認
- 本番デプロイ前のセキュリティレビュー
- システムプロンプトやツール権限の最適化

## ファイル構成

```
skills/claude/subagent-review/
├── README.md                      # このファイル
├── SKILL.md                       # メインスキル定義（レビュー基準、プロセス）
└── references/
    ├── best_practices.md          # サブエージェントのベストプラクティス
    └── examples.md                # 設定例とアンチパターン
```

## 使い方

### 基本的な使用方法

1. **単一サブエージェントのレビュー**
   ```
   「subagent-review スキルを使って code-formatter サブエージェント設定をレビューしてください」
   ```

2. **複数サブエージェントの監査**
   ```
   「.claude/subagents/ 内のすべてのサブエージェントを監査してください」
   ```

3. **コミット前の簡易チェック**
   ```
   「新しい test-runner エージェントはコミット準備できていますか？」
   ```

### レビュー対象

- `.claude/subagents/*.json` - サブエージェント設定ファイル
- システムプロンプト（別ファイルまたは設定内）
- ツールリスト
- バージョン情報

## 評価基準

### 5つの評価観点

詳細な評価基準は [SKILL.md](./SKILL.md) を参照してください。

#### 1. 単一責任原則 (Single Responsibility Principle)
- 明確で単一の目的を持つか
- 無関係なタスクが混在していないか
- フォーカスされた専門性があるか

#### 2. システムプロンプト品質 (System Prompt Quality)
- 具体的で実行可能な指示があるか
- 具体例が含まれているか
- 制約と制限が明確に定義されているか
- 期待される出力形式が指定されているか

#### 3. ツールアクセス制限 (Tool Access Restrictions)
- 必要なツールのみが付与されているか
- 高特権ツール（Bash, Write, Edit）の使用が正当化されているか
- セキュリティリスクが最小化されているか

#### 4. バージョン管理統合 (Version Control Integration)
- プロジェクト固有のサブエージェントがリポジトリに含まれているか
- 標準的な配置場所（`.claude/subagents/`）を使用しているか
- チーム全体で発見・使用可能か
- ドキュメント化されているか

#### 5. 適切な基盤 (Appropriate Foundation)
- Claude 生成のテンプレートをベースにしているか
- カスタマイズの理由が明確か
- 公式例のパターンに従っているか

### 評価ステータス

- ✅ **優秀**: ベストプラクティスに完全準拠
- ⚠️ **要改善**: 軽微な改善が必要
- ❌ **致命的な問題**: 重大な問題があり、修正が必要

### 優先度分類

- **セキュリティ**: 最優先（不要な Bash/Edit/Write ツールの削除など）
- **フォーカス**: 高優先（単一責任原則違反の分割など）
- **最適化**: 中優先（ドキュメント追加、システムプロンプト改善など）

## レビュー出力形式

### 詳細レビュー形式

包括的な監査や正式なレビューに使用：

```markdown
#### Sub-agent: [名前]

**Purpose:** [想定される目的の1文説明]

**Overall Assessment:** [ベストプラクティスへの準拠状況の簡潔なまとめ]

**Detailed Findings:**

##### 1. Single Responsibility: ✅/⚠️/❌
- [具体的な観察事項]
- [該当する場合の推奨事項]

##### 2. System Prompt Quality: ✅/⚠️/❌
...

**Priority Recommendations:**
1. [最優先の改善事項]
2. [次の優先度の改善事項]
3. [追加の推奨事項]
```

### 簡易評価形式

素早いチェックやコミット前の検証に使用：

```markdown
**Sub-agent**: [名前]

**Overall**: ✅ Ready / ⚠️ Needs Minor Fixes / ❌ Major Issues

**Brief Assessment**: [全体的な品質の1文サマリー]

**Top 3 Issues**:
1. [問題1 + 優先度インジケータ]
2. [問題2 + 優先度インジケータ]
3. [問題3 + 優先度インジケータ]

**Recommended Action**: [最も重要な次のステップ]
```

## レビュープロセス

### ステップ1: 設定ファイルの読み込み

サブエージェント定義、システムプロンプト、ツールリストを読み込みます。

### ステップ2: 各基準に対する評価

5つのレビュー基準に基づいて体系的に評価します。

### ステップ3: 発見事項の文書化

強みと改善領域を記録します。

### ステップ4: 推奨事項の優先順位付け

影響度によって問題をランク付けします（セキュリティ > フォーカス > 最適化）。

### ステップ5: 実行可能なガイダンスの提供

具体例付きの特定の変更を提案します。

## ベストプラクティス参照

詳細なベストプラクティスと例については、以下を参照してください：

- [references/best_practices.md](./references/best_practices.md) - 完全なベストプラクティス文書
- [references/examples.md](./references/examples.md) - サブエージェント設定例

## 使用例

### 例1: 単一サブエージェントのレビュー

**ユーザー**: "code-formatter サブエージェント設定をレビューしてください"

**出力例**:
```markdown
#### Sub-agent: code-formatter

**Purpose:** チームのスタイルガイドラインに従ってコードファイルをフォーマットする

**Overall Assessment:** ⚠️ 軽微な改善が必要な良好な基盤

**Detailed Findings:**

##### 1. Single Responsibility ✅ 優秀
- コードフォーマットのみに明確にフォーカス
- 目的が1文で表現可能
- 無関係な機能なし

##### 2. System Prompt Quality ⚠️ 要改善
- 指示は存在するがより具体的にできる
- 欠けている: 具体的な変換前後の例
- 欠けている: エッジケースの処理（例: 不正なコード）
- 推奨: 2-3個のフォーマット変換例を追加

...
```

### 例2: コミット前の簡易チェック

**ユーザー**: "新しい test-runner エージェントはコミット準備できていますか？"

**出力例**:
```markdown
**Sub-agent**: test-runner

**Overall**: ⚠️ Needs Minor Fixes

**Brief Assessment**: 2つの軽微な問題修正後にコミット可能な堅実な実装

**Top 3 Issues**:
1. 🟡 設定にバージョンフィールドを追加（チーム追跡のベストプラクティス）
2. 🟡 チームの発見可能性のため `.claude/README.md` にエージェントを文書化
3. 🟢 システムプロンプトにエラーハンドリング例があると改善

**Recommended Action**: バージョンフィールドと README エントリを追加すれば、コミット準備完了
```

### 例3: プロジェクト全サブエージェントの監査

**ユーザー**: ".claude/subagents/ 内のすべてのサブエージェントを監査してください"

**出力例**:
```markdown
# Sub-agent Audit Report

**Total agents reviewed**: 3
**Overall health**: ⚠️ 推奨改善ありで良好

## Summary by Agent

1. **code-reviewer** - ✅ 優秀（問題なし）
2. **test-generator** - ⚠️ 要改善（中優先度の問題2件）
3. **doc-writer** - ❌ 重大な問題（致命的1件、高優先度2件）

## Priority Actions

### Critical (即座に)
- **doc-writer**: 不要な Bash と KillShell ツールを削除（セキュリティリスク）

### High Priority (今週中)
- **test-generator**: システムプロンプトに具体例を追加
- **doc-writer**: フォーカスされたエージェントに分割（現在3つの無関係なタスクを処理）

...
```

## 注意事項

1. **設定ファイルの場所**: レビュー対象のサブエージェント設定ファイルのパスを明確に指定してください
2. **JSON 形式**: 設定ファイルは有効な JSON 形式である必要があります
3. **セキュリティ優先**: セキュリティに関する問題は最優先で対処します
4. **実行可能性**: すべての推奨事項は具体的で実行可能です
5. **具体例**: 改善提案には必ず Before/After の例を含めます

## 関連リンク

- [SKILL.md](./SKILL.md) - レビュー基準と詳細なプロセス
- [references/best_practices.md](./references/best_practices.md) - サブエージェントのベストプラクティス
- [references/examples.md](./references/examples.md) - 設定例とアンチパターン

---

このスキルにより、Claude Code サブエージェントの品質、セキュリティ、効果性を客観的に評価し、継続的な改善を支援します。
